# JSON可視化ツール - 要件定義書

## プロジェクト概要

**目的**: JSONデータをカードベースのビジュアル表現で可視化し、直感的に構造を理解できるツールを作成する

**配置場所**: `src/pages/JSONVisualization.vue`

**参考**: JSON Crack のようなノードベース可視化ツール

---

## 技術スタック

### 既存の技術資産
- **Vue 3** (Composition API / Options API)
- **Vue Router 4** (ページルーティング)
- **Tailwind CSS** (UI スタイリング)
- **js-yaml** (JSON パース機能)

### 新規追加ライブラリ
- **@vue-flow/core** - ノードベースのグラフUI
- **@vue-flow/background** (オプション) - グリッド背景
- **@vue-flow/controls** (オプション) - ズーム/パンコントロール

---

## 機能要件 (MVP - v1.0)

### 必須機能

#### 1. JSON入力機能
- テキストエリアでJSON文字列を入力
- JSON構文エラーのバリデーション
- サンプルJSONデータのロード機能

#### 2. カードベース可視化
- **カード粒度**: すべてのキー・バリューペアを個別のカードとして表示
  ```json
  {
    "name": "太郎",    // → カード1
    "age": 25,         // → カード2
    "address": {       // → カード3 (オブジェクト型)
      "city": "東京"   // → カード4
    }
  }
  ```

- **カード表示内容**:
  - キー名
  - 値 (プリミティブの場合)
  - データ型表示 (string, number, boolean, object, array, null)
  - オブジェクト/配列の場合は子要素数

- **カードデザイン**:
  - データ型ごとに色分け
  - Tailwind CSSで既存デザインに統一
  - 視認性の高いカードレイアウト

#### 3. 接続線の表示
- **親子関係の可視化**: オブジェクトの階層構造を線で表現
  - `user` → `name`
  - `user` → `age`
  - `user` → `address` → `city`

- **線のスタイル**:
  - シンプルな実線
  - 矢印で方向性を示す
  - 色は統一 (または親カードの色を継承)

#### 4. インタラクティブ機能
- **ドラッグ&ドロップ**: 各カードを自由に移動可能
- **パン**: キャンバス全体のドラッグ移動
- **ズーム**: マウスホイールでズームイン/アウト

#### 5. 自動レイアウト
- 初期表示時に階層構造に基づいた自動配置
- レイアウトアルゴリズム: 縦方向の階層レイアウト (Top to Bottom)

---

## データモデル設計

### JSON → ノード変換ロジック

```javascript
// 入力JSON例
{
  "user": {
    "name": "太郎",
    "age": 25
  }
}

// 変換後のノード構造
[
  {
    id: "root",
    type: "objectCard",
    data: { key: "root", value: null, dataType: "object", childCount: 1 },
    position: { x: 0, y: 0 }
  },
  {
    id: "root.user",
    type: "objectCard",
    data: { key: "user", value: null, dataType: "object", childCount: 2 },
    position: { x: 0, y: 100 }
  },
  {
    id: "root.user.name",
    type: "primitiveCard",
    data: { key: "name", value: "太郎", dataType: "string" },
    position: { x: -100, y: 200 }
  },
  {
    id: "root.user.age",
    type: "primitiveCard",
    data: { key: "age", value: 25, dataType: "number" },
    position: { x: 100, y: 200 }
  }
]

// エッジ (接続線) 構造
[
  { id: "e-root-user", source: "root", target: "root.user" },
  { id: "e-user-name", source: "root.user", target: "root.user.name" },
  { id: "e-user-age", source: "root.user", target: "root.user.age" }
]
```

### データ型分類

| データ型 | 判定ロジック | カード色 (Tailwind) |
|---------|-------------|-------------------|
| string | `typeof === 'string'` | `bg-blue-600` |
| number | `typeof === 'number'` | `bg-green-600` |
| boolean | `typeof === 'boolean'` | `bg-yellow-600` |
| null | `value === null` | `bg-gray-600` |
| array | `Array.isArray()` | `bg-purple-600` |
| object | `typeof === 'object' && !Array.isArray()` | `bg-pink-600` |

---

## UI/UX設計

### ページレイアウト

```
┌─────────────────────────────────────────────────────────┐
│  JSON可視化ツール                 [Bellsanct Tools]      │ ← ヘッダー (bg-gray-800)
├─────────────────────────────────────────────────────────┤
│                                                          │
│  ┌────────────────────────────────────────────────┐    │
│  │ JSON入力エリア (textarea)                      │    │
│  │ {                                               │    │
│  │   "user": { "name": "太郎", "age": 25 }        │    │
│  │ }                                               │    │
│  └────────────────────────────────────────────────┘    │
│                                                          │
│  [可視化実行] [サンプルロード] [クリア]                  │
│                                                          │
├─────────────────────────────────────────────────────────┤
│                                                          │
│  可視化キャンバス (Vue Flow)                             │
│  ┌──────────────────────────────────────────────┐      │
│  │                                               │      │
│  │   ┌───────────┐                              │      │
│  │   │  user     │ (object)                     │      │
│  │   │  [2 keys] │                              │      │
│  │   └─────┬─────┘                              │      │
│  │         ├─────────┐                          │      │
│  │         ↓         ↓                          │      │
│  │   ┌─────────┐ ┌─────────┐                   │      │
│  │   │  name   │ │  age    │                   │      │
│  │   │  "太郎" │ │  25     │                   │      │
│  │   └─────────┘ └─────────┘                   │      │
│  │                                               │      │
│  └──────────────────────────────────────────────┘      │
│                                                          │
│  ズーム: [+] [-]  レイアウト: [リセット]                │
│                                                          │
└─────────────────────────────────────────────────────────┘
```

### カードコンポーネント設計

**プリミティブ値カード**:
```
┌─────────────────┐
│  key: "name"    │ ← キー名 (font-bold)
│  ─────────────  │
│  "太郎"         │ ← 値
│  [string]       │ ← 型表示 (text-xs)
└─────────────────┘
```

**オブジェクト/配列カード**:
```
┌─────────────────┐
│  key: "user"    │ ← キー名 (font-bold)
│  ─────────────  │
│  { ... }        │ ← オブジェクト表示
│  [object]       │ ← 型表示
│  2 keys         │ ← 子要素数
└─────────────────┘
```

---

## コンポーネント構造

### ファイル構成案

```
src/
├── pages/
│   └── JSONVisualization.vue      # メインページコンポーネント
├── components/
│   ├── json-viz/
│   │   ├── PrimitiveCard.vue      # プリミティブ値用カード
│   │   ├── ObjectCard.vue         # オブジェクト/配列用カード
│   │   └── JSONParser.js          # JSON → ノード変換ロジック
└── router/
    └── index.js                    # ルート追加
```

### コンポーネント責務

**JSONVisualization.vue** (親コンポーネント)
- JSON入力の管理
- Vue Flow の初期化
- ノード・エッジデータの管理
- レイアウト制御

**PrimitiveCard.vue** (カスタムノード)
- string, number, boolean, null の表示
- データ型に応じたスタイリング

**ObjectCard.vue** (カスタムノード)
- object, array の表示
- 子要素数の表示

**JSONParser.js** (ユーティリティ)
- JSON文字列のパース
- ノード構造への変換
- エッジ構造の生成
- 自動レイアウト計算

---

## 実装フェーズ

### Phase 1: 基本セットアップ ✅ (次のステップ)
- [ ] Vue Flow のインストール
- [ ] ルーター設定の更新
- [ ] 基本的なページ構造の作成

### Phase 2: データパース機能
- [ ] JSON → ノード変換ロジック実装
- [ ] データ型判定ロジック
- [ ] エッジ生成ロジック

### Phase 3: カードコンポーネント
- [ ] PrimitiveCard.vue 実装
- [ ] ObjectCard.vue 実装
- [ ] データ型別スタイリング

### Phase 4: 可視化機能
- [ ] Vue Flow 統合
- [ ] 自動レイアウト実装
- [ ] ドラッグ&ドロップ有効化

### Phase 5: UX改善
- [ ] エラーハンドリング
- [ ] サンプルデータ機能
- [ ] UIの最終調整

---

## 技術的考慮事項

### パフォーマンス
- 大規模JSON (1000+ キー) の場合の最適化は後回し
- 初期版では小〜中規模JSON (< 100 キー) を想定

### ブラウザ互換性
- モダンブラウザのみサポート (既存プロジェクトに準拠)
- Vue 3 対応ブラウザ

### エラーハンドリング
- JSON構文エラー → alert or エラーメッセージ表示
- 循環参照の検出 (将来対応)

---

## 最終決定事項 (2025-11-10)

### ✅ 確定仕様

**1. ルートオブジェクトの表示**
- 常にルートカードを表示する (パターンA)
- ルートノードID: `"root"`
- 単一キーでも省略しない

**2. 配列の扱い**
- 配列自体が1つのカード + 各要素が個別カード
- 配列要素のキー: `[0]`, `[1]`, `[2]` ...
- 配列内オブジェクトも完全展開
  ```
  users (array, 2 items)
    ├─ [0] (object, 2 keys)
    │    ├─ name (string)
    │    └─ age (number)
    └─ [1] (object, 2 keys)
  ```

**3. 文字列の長さ制限**
- v1.0では制限なし (カードが自動拡大)
- 将来的にホバー機能やスクロール対応を検討

**4. レイアウトスタイル**
- 縦方向の階層レイアウト (家系図スタイル)
- 文字は左から右 (横書き)
- Y軸: 深さ × 150px
- X軸: 兄弟ノードを水平均等配置

---

## 将来の拡張機能 (v2.0以降)

### 検討中の機能
- [ ] ノードの折りたたみ/展開
- [ ] JSONの編集機能 (カード上で値を編集)
- [ ] エクスポート機能 (PNG, SVG)
- [ ] 複数JSONの比較表示
- [ ] 検索・フィルタリング
- [ ] カスタムレイアウトアルゴリズム選択
- [ ] ダークモード切り替え
- [ ] ファイルアップロード対応

---

## 参考リンク

- Vue Flow 公式: https://vueflow.dev/
- JSON Crack: https://jsoncrack.com/
- Tailwind CSS: https://tailwindcss.com/

---

## まとめ

### 決定事項
✅ カード粒度: すべてのキー・バリューペアを個別カード化
✅ ライブラリ: Vue Flow
✅ MVP機能: JSON入力 + カード表示 + D&D
✅ 配置場所: `src/pages/JSONVisualization.vue`
✅ デザイン: 既存の Tailwind + グレー系スキームに統一

### 次のアクション
1. Vue Flow のインストール (`npm install @vue-flow/core`)
2. ルーター設定の更新
3. `JSONVisualization.vue` の実装開始

---

**作成日**: 2025-11-10
**バージョン**: 1.0 (MVP仕様)
